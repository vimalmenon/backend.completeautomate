[tox]
envlist = py313,black,flake8,mypy
isolated_build = True
skipsdist = True

[testenv]
description = Run tests with pytest
deps =
    pytest>=7.4.0
    pytest-cov>=4.1.0
    pytest-mock>=3.11.1
allowlist_externals = poetry
commands_pre =
    poetry install --no-root
commands =
    poetry run pytest tests/ -v --cov=backend --cov-report=term-missing --cov-report=html

[testenv:black]
description = Check code formatting with black
deps = black>=24.0.0
commands_pre =
    poetry install --no-root
commands =
    poetry run black --check backend/ tests/ main.py

[testenv:black-fix]
description = Format code with black
deps = black>=24.0.0
commands_pre =
    poetry install --no-root
commands =
    poetry run black backend/ tests/ main.py

[testenv:flake8]
description = Run flake8 linter
deps = flake8>=7.0.0
commands_pre =
    poetry install --no-root
commands =
    poetry run flake8 backend/ tests/ main.py --count --statistics --max-line-length=88 --extend-ignore=E203,W503

[testenv:mypy]
description = Run mypy type checker
deps =
    mypy>=1.19.1
    boto3-stubs>=1.42.27
commands_pre =
    poetry install --no-root
commands =
    poetry run mypy backend/ main.py

[testenv:check]
description = Run all checks (black, flake8, mypy, tests)
deps =
    black>=24.0.0
    flake8>=7.0.0
    mypy>=1.19.1
    boto3-stubs>=1.42.27
    pytest>=7.4.0
    pytest-cov>=4.1.0
    pytest-mock>=3.11.1
commands_pre =
    poetry install --no-root
commands =
    poetry run black --check backend/ tests/ main.py
    poetry run flake8 backend/ tests/ main.py --count --statistics --max-line-length=88 --extend-ignore=E203,W503
    poetry run mypy backend/ main.py
    poetry run pytest tests/ -v --cov=backend --cov-report=term-missing

[testenv:fix]
description = Auto-fix issues (format with black)
deps = black>=24.0.0
commands_pre =
    poetry install --no-root
commands =
    poetry run black backend/ tests/ main.py

# Flake8 configuration
[flake8]
max-line-length = 88
extend-ignore = E203, W503, E501
exclude =
    .git,
    __pycache__,
    .venv,
    .tox,
    build,
    dist,
    *.egg-info,
    .mypy_cache,
    .pytest_cache
max-complexity = 10
per-file-ignores =
    __init__.py:F401
